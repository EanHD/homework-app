# Implementation Plan: [FEATURE]

**Branch**: `[###-feature-name]` | **Date**: [DATE] | **Spec**: [link]
**Input**: Feature specification from `/specs/[###-feature-name]/spec.md`

## Execution Flow (/plan command scope)
```
1. Load feature spec from Input path
   → If not found: ERROR "No feature spec at {path}"
2. Fill Technical Context (scan for NEEDS CLARIFICATION)
   → Detect Project Type from context (web=frontend+backend, mobile=app+api)
   → Set Structure Decision based on project type
3. Evaluate Constitution Check section below
   → If violations exist: Document in Complexity Tracking
   → If no justification possible: ERROR "Simplify approach first"
│   ├── components/
   # Implementation Plan: Add simple login screen (Supabase)

   **Branch**: `011-add-simple-login` | **Date**: 2025-09-12 | **Spec**: `/specs/011-add-simple-login/spec.md`
   **Input**: Feature specification from `/specs/011-add-simple-login/spec.md`

   ## Execution Flow (/plan command scope)
   ```
   1. Load feature spec from Input path (done)
   2. Fill Technical Context (this file)
   3. Constitution Check (see section below)
   4. Execute Phase 0 → generate `research.md` (choices/clarifications resolved)
   5. Execute Phase 1 → generate `data-model.md`, `/contracts/*`, `quickstart.md`
   6. Re-evaluate Constitution Check and document any deviations
   7. Describe Phase 2 (task generation approach) — STOP (tasks created by `/tasks`)
   ```

   **Important**: This plan stops at describing Phase 2. The `/tasks` command will produce the final task list for implementation.

   ## Summary
   Add a simple, secure login flow using Supabase Auth to enable cross-device sync of user preferences, push subscriptions, and scheduled reminders. Providers to enable: Email (magic link), Google, Apple (where supported). Use Supabase client (`@supabase/supabase-js`) in the frontend to manage sessions; map push subscriptions and scheduled rows to `user_id` in the DB.

   ## Technical Context
   - Language/Platform: TypeScript / React (existing project)
   - Primary Dependency: Supabase (Auth + Postgres + Edge Functions)
   - Storage: Supabase PostgreSQL (existing)
   - Testing: existing Vitest + Playwright suites (follow repo conventions)
   - Target Platform: Web PWA (browser, iOS/Android web)
   - Project Type: Web application (frontend + Supabase backend)
   - Constraints: Keep server changes minimal; prefer Supabase managed auth to avoid handling passwords or tokens directly.

   ## Constitution Check
   - Simplicity: single-feature addition integrated into existing web project (no extra services). PASS.
   - Architecture: Leverage Supabase as managed backend; changes limited to DB schema (add `user_id` FKs) and small function updates where necessary. PASS.
   - Testing: TDD-friendly — contract tests will be generated and must fail before implementation. PASS (plan enforces tests-first).

   ## Phase 0: Outline & Research (completed)
   See `research.md` — decisions and rationale for choosing Supabase Auth (magic link + Google/Apple) and mapping approach for push subscriptions and schedules. Research resolved the spec's NEEDS_CLARIFICATION items.

   ## Phase 1: Design & Contracts (completed)
   - `data-model.md` generated: User, PushSubscription, ScheduledNotification mappings and SQL migration snippets.
   - Contracts generated under `/specs/011-add-simple-login/contracts/`: `auth.md` (notes about Supabase Auth integration), `user-profile.md`, `subscribe.md`, `schedule.md`.
   - `quickstart.md` generated with step-by-step Supabase setup instructions for beginners (create project, enable providers, deploy functions, set env vars, set VAPID keys).

   ## Phase 2: Task Planning Approach (described)
   The `/tasks` command will generate tasks using the repo `templates/tasks-template.md`. Key strategy:
   - TDD order: generate contract tests first for `/subscribe`, `/schedule`, and user-profile behavior.
   - Data-first: apply DB migrations (add `user_id` on `push_subscriptions` and `scheduled_notifications`).
   - Backend: adjust Supabase Edge Functions (`subscribe`, `schedule`, `send-notifications`) to require/accept authenticated `user_id` (via JWT or service role where appropriate).
   - Frontend: implement login UI, session management (supabase-js), map subscription creation to current user, and update Settings diagnostics to reflect authenticated user.

   ## Complexity Tracking
   No constitutional violations identified; approach favors managed auth to keep implementation simple.

   ## Progress Tracking
   - [x] Phase 0: Research complete
   - [x] Phase 1: Design complete
   - [x] Phase 2: Task planning described (tasks to be generated by `/tasks`)
   - [ ] Phase 3: Tasks generated
   - [ ] Phase 4: Implementation complete
   - [ ] Phase 5: Validation passed

   - [x] Initial Constitution Check: PASS
   - [x] Post-Design Constitution Check: PASS
   - [x] All NEEDS CLARIFICATION resolved (see `research.md`)

   ---
   *Artifacts generated by this /plan run (absolute paths):*

   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/research.md
   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/data-model.md
   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/quickstart.md
   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/contracts/auth.md
   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/contracts/user-profile.md
   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/contracts/subscribe.md
   - /home/eanhd/projects/homework-app/homework-app/specs/011-add-simple-login/contracts/schedule.md

   ---
   Next: run `/tasks` to generate the TDD-ordered implementation tasks (Phase 2). Once tasks.md exists, we can implement step-by-step and run the test suites.

   *Based on Constitution v2.1.1 - See `/memory/constitution.md`*